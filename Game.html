<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kai's Digital Monopoly - Good Luck, You'll Need It</title>
    <style>
        :root {
            --board-bg: #bfdbfe;
            --cell-border: #333;
            --brown: #955436;
            --lightblue: #aae0fa;
            --pink: #d93a96;
            --orange: #f7941d;
            --red: #ed1b24;
            --yellow: #fef200;
            --green: #1fb25a;
            --darkblue: #0072bb;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        .game-container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }

        /* The Board Layout */
        #board {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            grid-template-rows: repeat(11, 1fr);
            width: 650px;
            height: 650px;
            background: #dee2e6;
            border: 5px solid #333;
            position: relative;
        }

        .cell {
            border: 1px solid var(--cell-border);
            background: white;
            color: black;
            font-size: 9px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 2px;
            position: relative;
            overflow: hidden;
        }

        .cell .color-bar {
            height: 15px;
            width: 100%;
            border-bottom: 1px solid #333;
        }

        /* Player Tokens */
        .token {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            z-index: 10;
            transition: all 0.5s ease;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        /* Sidebar */
        .controls {
            flex: 1;
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .player-stat {
            padding: 10px;
            border-radius: 5px;
            background: #3d3d3d;
            margin-bottom: 5px;
        }

        .player-stat.active {
            border: 2px solid #4ade80;
        }

        button {
            padding: 12px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            background: #4ade80;
            color: #1a1a1a;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        #log {
            height: 150px;
            overflow-y: auto;
            background: #000;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            color: #0f0;
            border-radius: 5px;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: black;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 100;
            display: none;
            text-align: center;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            z-index: 99;
        }
    </style>
</head>
<body>

    <h1>Kai's Monopoly</h1>
    <p style="color: #aaa; margin-top: -10px;">Where dreams go to die and rent is too high.</p>

    <div class="game-container">
        <div id="board">
            <!-- Cells will be generated by JS -->
        </div>

        <div class="controls">
            <div id="playerList"></div>
            
            <div style="text-align: center;">
                <h2 id="diceResult">ðŸŽ² -</h2>
                <button id="rollBtn" onclick="playTurn()">Roll Dice</button>
            </div>

            <div id="log">Game started. Add players to begin.</div>
            
            <div id="setup">
                <input type="text" id="pName" placeholder="Player Name">
                <button onclick="addPlayer()">Add Player</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="modal" id="modal">
        <h2 id="modalTitle">Property</h2>
        <p id="modalText"></p>
        <div id="modalActions"></div>
    </div>

    <script>
        const boardData = [
            { name: "GO", type: "special" },
            { name: "Med. Avenue", type: "prop", price: 60, rent: 2, group: "brown" },
            { name: "Comm. Chest", type: "special" },
            { name: "Baltic Avenue", type: "prop", price: 60, rent: 4, group: "brown" },
            { name: "Income Tax", type: "tax", price: 200 },
            { name: "Reading RR", type: "prop", price: 200, rent: 25, group: "railroad" },
            { name: "Oriental Ave", type: "prop", price: 100, rent: 6, group: "lightblue" },
            { name: "Chance", type: "special" },
            { name: "Vermont Ave", type: "prop", price: 100, rent: 6, group: "lightblue" },
            { name: "Conn. Ave", type: "prop", price: 120, rent: 8, group: "lightblue" },
            { name: "Jail", type: "special" },
            { name: "St. Charles", type: "prop", price: 140, rent: 10, group: "pink" },
            { name: "Electric Co.", type: "prop", price: 150, rent: 10, group: "utility" },
            { name: "States Ave", type: "prop", price: 140, rent: 10, group: "pink" },
            { name: "Virginia Ave", type: "prop", price: 160, rent: 12, group: "pink" },
            { name: "Penn RR", type: "prop", price: 200, rent: 25, group: "railroad" },
            { name: "St. James", type: "prop", price: 180, rent: 14, group: "orange" },
            { name: "Comm. Chest", type: "special" },
            { name: "Tenn. Ave", type: "prop", price: 180, rent: 14, group: "orange" },
            { name: "NY Avenue", type: "prop", price: 200, rent: 16, group: "orange" },
            { name: "Free Parking", type: "special" },
            { name: "Kentucky Ave", type: "prop", price: 220, rent: 18, group: "red" },
            { name: "Chance", type: "special" },
            { name: "Indiana Ave", type: "prop", price: 220, rent: 18, group: "red" },
            { name: "Illinois Ave", type: "prop", price: 240, rent: 20, group: "red" },
            { name: "B&O RR", type: "prop", price: 200, rent: 25, group: "railroad" },
            { name: "Atlantic Ave", type: "prop", price: 260, rent: 22, group: "yellow" },
            { name: "Ventnor Ave", type: "prop", price: 260, rent: 22, group: "yellow" },
            { name: "Water Works", type: "prop", price: 150, rent: 10, group: "utility" },
            { name: "Marvin Gard.", type: "prop", price: 280, rent: 24, group: "yellow" },
            { name: "Go To Jail", type: "special" },
            { name: "Pacific Ave", type: "prop", price: 300, rent: 26, group: "green" },
            { name: "NC Avenue", type: "prop", price: 300, rent: 26, group: "green" },
            { name: "Comm. Chest", type: "special" },
            { name: "Penn Ave", type: "prop", price: 320, rent: 28, group: "green" },
            { name: "Short Line", type: "prop", price: 200, rent: 25, group: "railroad" },
            { name: "Chance", type: "special" },
            { name: "Park Place", type: "prop", price: 350, rent: 35, group: "darkblue" },
            { name: "Luxury Tax", type: "tax", price: 100 },
            { name: "Boardwalk", type: "prop", price: 400, rent: 50, group: "darkblue" }
        ];

        let players = [];
        let turn = 0;
        let gameStarted = false;

        // Map board index to grid positions (11x11)
        function getGridPos(i) {
            if (i <= 10) return { r: 11, c: 11 - i }; // Bottom row
            if (i <= 20) return { r: 11 - (i - 10), c: 1 }; // Left col
            if (i <= 30) return { r: 1, c: i - 19 }; // Top row
            return { r: i - 29, c: 11 }; // Right col
        }

        function initBoard() {
            const board = document.getElementById('board');
            boardData.forEach((data, i) => {
                const pos = getGridPos(i);
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                cell.style.gridRow = pos.r;
                cell.style.gridColumn = pos.c;
                
                if (data.group && data.group !== 'railroad' && data.group !== 'utility') {
                    const bar = document.createElement('div');
                    bar.className = 'color-bar';
                    bar.style.backgroundColor = `var(--${data.group})`;
                    cell.appendChild(bar);
                }
                
                const name = document.createElement('div');
                name.innerText = data.name;
                cell.appendChild(name);

                if (data.price) {
                    const price = document.createElement('div');
                    price.innerText = `$${data.price}`;
                    cell.appendChild(price);
                }
                
                board.appendChild(cell);
            });
        }

        function addPlayer() {
            const name = document.getElementById('pName').value;
            if (!name) return;
            const colors = ['#ff4d4d', '#4d79ff', '#4dff4d', '#ffff4d'];
            const p = {
                name: name,
                money: 1500,
                pos: 0,
                color: colors[players.length],
                properties: []
            };
            players.push(p);
            document.getElementById('pName').value = '';
            log(`${name} joined the game.`);
            updateUI();
            
            const token = document.createElement('div');
            token.className = 'token';
            token.id = `token-${players.length - 1}`;
            token.style.backgroundColor = p.color;
            document.getElementById('board').appendChild(token);
            moveToken(players.length - 1, 0);
        }

        function moveToken(pIdx, pos) {
            const token = document.getElementById(`token-${pIdx}`);
            const cell = document.getElementById(`cell-${pos}`);
            const rect = cell.getBoundingClientRect();
            const boardRect = document.getElementById('board').getBoundingClientRect();
            
            // Offset tokens slightly so they don't stack perfectly like a game of checkers
            const offset = pIdx * 5; 
            token.style.top = (cell.offsetTop + 10 + offset) + 'px';
            token.style.left = (cell.offsetLeft + 10 + offset) + 'px';
        }

        function playTurn() {
            if (players.length < 2) {
                log("You need at least two players. Playing alone is just sad.");
                return;
            }

            const p = players[turn];
            const die1 = Math.floor(Math.random() * 6) + 1;
            const die2 = Math.floor(Math.random() * 6) + 1;
            const total = die1 + die2;

            document.getElementById('diceResult').innerText = `ðŸŽ² ${die1} + ${die2} = ${total}`;
            log(`${p.name} rolled a ${total}.`);

            let newPos = p.pos + total;
            if (newPos >= 40) {
                newPos -= 40;
                p.money += 200;
                log(`${p.name} passed GO and collected $200. Don't spend it all in one place.`);
            }

            p.pos = newPos;
            moveToken(turn, p.pos);
            handleLanding(turn, p.pos);

            // Next turn
            turn = (turn + 1) % players.length;
            updateUI();
        }

        function handleLanding(pIdx, pos) {
            const p = players[pIdx];
            const space = boardData[pos];

            if (space.type === 'prop') {
                const ownerIdx = players.findIndex(player => player.properties.includes(pos));
                
                if (ownerIdx === -1) {
                    // Unowned
                    showModal(
                        `Buy ${space.name}?`,
                        `${space.name} costs $${space.price}. Rent is $${space.rent}.`,
                        `<button onclick="buyProperty(${pIdx}, ${pos})">Buy</button>
                         <button onclick="closeModal()">Pass</button>`
                    );
                } else if (ownerIdx !== pIdx) {
                    // Pay Rent
                    const owner = players[ownerIdx];
                    p.money -= space.rent;
                    owner.money += space.rent;
                    log(`${p.name} paid $${space.rent} rent to ${owner.name}.`);
                }
            } else if (space.type === 'tax') {
                p.money -= space.price;
                log(`${p.name} paid $${space.price} in taxes. The government thanks you.`);
            } else if (space.name === "Go To Jail") {
                p.pos = 10;
                moveToken(pIdx, 10);
                log(`${p.name} was sent to Jail. Do not pass GO.`);
            }
        }

        function buyProperty(pIdx, pos) {
            const p = players[pIdx];
            const space = boardData[pos];
            if (p.money >= space.price) {
                p.money -= space.price;
                p.properties.push(pos);
                log(`${p.name} bought ${space.name} for $${space.price}.`);
                
                // Visual indicator of ownership
                const cell = document.getElementById(`cell-${pos}`);
                cell.style.boxShadow = `inset 0 0 0 4px ${p.color}`;
            } else {
                log(`${p.name} is too poor to afford ${space.name}. Embarrassing.`);
            }
            closeModal();
            updateUI();
        }

        function showModal(title, text, actions) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalText').innerText = text;
            document.getElementById('modalActions').innerHTML = actions;
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('rollBtn').disabled = true;
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('rollBtn').disabled = false;
        }

        function log(msg) {
            const logBox = document.getElementById('log');
            logBox.innerHTML += `<div>> ${msg}</div>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        function updateUI() {
            const list = document.getElementById('playerList');
            list.innerHTML = '';
            players.forEach((p, i) => {
                const div = document.createElement('div');
                div.className = `player-stat ${turn === i ? 'active' : ''}`;
                div.style.borderLeft = `5px solid ${p.color}`;
                div.innerHTML = `
                    <strong>${p.name}</strong><br>
                    Money: $${p.money}<br>
                    Properties: ${p.properties.length}
                `;
                list.appendChild(div);
            });

            if (players.length >= 2) {
                document.getElementById('setup').style.display = 'none';
            }
        }

        window.onload = initBoard;
    </script>
</body>
</html>
